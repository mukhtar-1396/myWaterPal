<!DOCTYPE html>
<html>
<head>
    <title>Tracker</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type='text/javascript' src='knockout-3.2.0.js'></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @media only screen and (min-width: 768px) {
            /* For desktop: */
            .col-1 {
                width: 8.33%;
            }

            .col-2 {
                width: 16.66%;
            }

            .col-3 {
                width: 25%;
            }

            .col-4 {
                width: 33.33%;
            }

            .col-5 {
                width: 41.66%;
            }

            .col-6 {
                width: 50%;
            }

            .col-7 {
                width: 58.33%;
            }

            .col-8 {
                width: 66.66%;
            }

            .col-9 {
                width: 75%;
            }

            .col-10 {
                width: 83.33%;
            }

            .col-11 {
                width: 91.66%;
            }

            .col-12 {
                width: 100%;
            }
        }
    </style>
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <p unselectable="on" class="navbar-brand"><span class="glyphicon glyphicon-tint" aria-hidden="true"></span> My Water Pal</p>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="home.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="tracker.html">Water Tracker</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="login.html"><span class="glyphicon glyphicon-user" aria-hidden="true"></span>  Login</a></li>
                <li><a href="signup.html"><span class="glyphicon glyphicon-user" aria-hidden="true"></span>  Sign up</a></li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>
<div class="transbox">
    <div id="trackerContent">
        <div id="horizontal-progress-bar">
            <progress id="progress" value='0' max='100'></progress>
        </div>
        <div class="buttons">
            <a class='button btn btn-default' data-bind='click: resetClicks' data-diff='-100'>Reset</a>
            <a class='button btn btn-default ' data-bind='click: registerClick' data-diff='13'>+</a>    
        </div>
        <div>You've drank <span data-bind='text: numberOfClicks'>&nbsp;</span> cup(s) today!</div>
        <script>
            // We use consts here for the keys for good practice, and to make sure the key is always correct
            const WATER_CONSUMED = 'waterConsumed';
            const CUPS_CONSUMED = 'cupsConsumed';

            /**
             * This ensures the dom is ready before executing the code
             * https://learn.jquery.com/using-jquery-core/document-ready/
             */
            $(function () {
                setAndAnimateProgress(getLocalStorage(WATER_CONSUMED));
                ko.applyBindings(new ClickCounterViewModel());
            });

            /**
             * gets Local Storage Value
             * @param key
             * @returns {number}
             */
            const getLocalStorage = (key) => {
                let waterConsumed = localStorage.getItem(key);

                // if undefined, meaning no key exists...
                if (!waterConsumed){
                    localStorage.setItem(key, '0');
                    return 0;
                }

                // convert value stored as a string to a number
                return parseInt(waterConsumed, 10);
            };

            /**
             * sets Local Storage Value
             * @param key
             * @param amount
             */
            const setLocalStorage = (key, amount) => {
                localStorage.setItem(key, amount.toString());
            };

            /**
             * sets and animates the water value
             * @param value
             */
            const setAndAnimateProgress = (value) => {
                $("#progress").animate({value}, 500);
            };

            // changing progressbar when button is clicked
            $(".button").click(function () {
                animateProgress(parseInt($(this).data('diff')));
            });

            /**
             * animate progress by a step indicated by diff
             * @param diff
             */
            function animateProgress(diff) {
                // var currValue = $("#progress").val();
                var currValue = getLocalStorage(WATER_CONSUMED);
                var toValue = currValue + diff;

                toValue = toValue < 0 ? 0 : toValue;
                toValue = toValue > 100 ? 100 : toValue;

                setLocalStorage(WATER_CONSUMED, toValue);

                setAndAnimateProgress(toValue);
            }

            /**
             * display number of cups drank today
             * @constructor
             */
            var ClickCounterViewModel = function () {
                this.numberOfClicks = ko.observable(getLocalStorage(CUPS_CONSUMED));

                this.registerClick = function () {
                    const cupsConsumed = this.numberOfClicks() + 1;
                    this.numberOfClicks(cupsConsumed);
                    setLocalStorage(CUPS_CONSUMED, cupsConsumed);
                };
                this.resetClicks = function () {
                    this.numberOfClicks(0);
                    setLocalStorage(CUPS_CONSUMED, 0);
                };
                this.hasClickedTooManyTimes = ko.pureComputed(function () {
                    return this.numberOfClicks();
                }, this);
            };

        </script>
    </div>
</div>





<br>
<br>
<br>
<!-- Footer -->
<div class="footer">
    <!-- Copyright -->
    <div class=" text-center py-3">
        ï¿½ 2019 Copyright:
        <a href="https://mdbootstrap.com/education/bootstrap/"> mywaterpal.com</a>
    </div>
</div>




<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"></script>
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

<!-- Experiment with Horizontal progress bar -->

</body>
</html>